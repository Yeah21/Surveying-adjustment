a=[-10.9027 395.4
    4.2166 117.2
    0.2699 68.8
    5.9327 148.8
    1.1052 65.7
    -0.7456 84.2
    -3.3537 91.7
    0.1652 87
    2.7803 62.8
    -1.6969 74.3
    -5.7241 119.6];
w=zeros(11,1);
for i =1:11
    w(i)=a(i,1);
end
w(1)=-10.9027+573.543;
x=zeros(9,1);
%% 矩阵系数
B=zeros(11,9);
B(1,9)=1;
B(2,4)=1;B(2,9)=-1;
B(3,9)=1;B(3,3)=-1;
B(4,5)=1;B(4,4)=-1;
B(5,6)=1;B(5,5)=-1;
B(6,7)=1;B(6,6)=-1;   
B(7,1)=1;B(7,7)=-1;
B(8,1)=1;B(8,8)=-1;
B(9,8)=1;B(9,4)=-1;
B(10,2)=1;B(10,1)=-1;
B(11,3)=1;B(11,2)=-1;
%% 权重赋值
P=zeros(11,11);
for i=1:11
   P(i,i)=100/a(i,2);
end
%% 解算
ni=inv(B'*P*B);
x=ni*B'*P*w;
v=B*x-w;
L=a(:,1)+v;
%% 检核
% m=zeros(2,11);%条件方程
% m(1,:)=[0 1 1 0 0 0 0 1 1 1 1];%条件方程
% m(2,:)=[0 0 0 1 1 1 1 -1 -1 0 0];%条件方程
% m*L
Q=ni;
Q1=B*Q*B';
m0=v'*P*v/(11-9);
for i = 1:length(Q)
   fprintf('第%d号点高程的精度%d\n',i,m0*Q(i,i)) 
   fprintf('第%d条观测线的精度%d\n',i,m0*Q1(i,i)) 
end
